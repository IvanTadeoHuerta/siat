define(["routing","classie"],function(e,o){var n={imagenUrl:e.rutaImagenes,derechos:"Tech Pro® 2017 Todos Los Derechos Reservados",empresa:{id:"empresa",name:"empresa"},usuario:{id:"usuario",name:"usuario"},password:{id:"password",name:"password"},botonLogin:{id:"btnBotonInicioSesion"},formularioLogin:{id:"formLogin"},etiquetaError:{id:"mostrarError"},recordar:{id:"recordar"}},i={_login:function(){return'<div class="container">\n                            <div class="row">\n                                <div class="col-md-4 col-md-offset-4">                               \n                                    <div class="login-panel panel-personalizado panel-default">\n                                        <div class="panel-heading text-center" style="background-color: transparent; border-color: transparent;">\n                                            <img src="'+n.imagenUrl+'techproLogin.png" class="img-responsive" style="width: 340px; height: 100px;">\n                                        </div>\n                                        <div class="panel-body">\n                                            <form id="'+n.formularioLogin.id+'" role="form" autocomplete="off" onsubmit="return false;">\n                                                <fieldset>\n                                                    <div class="form-group text-center">\n                                                        <!--<input class="form-control" placeholder="E-mail" name="email" type="email" autofocus>-->\n                                                        <span class="input input--hoshi">\n                                                            <input class="input__field input__field--hoshi1" type="text" id="'+n.usuario.id+'" name="'+n.usuario.name+'"/>\n                                                            <label class="input__label input__label--hoshi1 input__label--hoshi1-color-4" for="txtUsuario">\n                                                                <p><span class="input__label-content input__label-content--hoshi">USUARIO</span></p>\n                                                            </label>\n                                                        </span>\n                                                        <div class="errorUsuario" style="margin-top:-15px"></div>\n                                                    </div>\n                                                    <div class="form-group text-center">\n                                                        <span class="input input--hoshi">\n                                                            <input class="input__field input__field--hoshi1" type="password" id="'+n.password.id+'" name="'+n.password.name+'" />\n                                                            <label class="input__label input__label--hoshi1 input__label--hoshi1-color-4" for="txtPassword">\n                                                                <p><span class="input__label-content input__label-content--hoshi">CONTRASEÑA</span></p>\n                                                            </label>\n                                                        </span>\n                                                        <div class="errorPassword" style="margin-top:-15px"></div>\n                                                    </div>\n                                                    <label style="color:red" id="'+n.etiquetaError.id+'"></label>\n                                                    <div class="col-md-4 col-sm-4 col-xs-12 col-md-offset-3 text-center">\n                                                        <!-- Change this to a button or input when using this as a form -->\n                                                        <button type="submit" id="'+n.botonLogin.id+'" class="btn btn-default text-center" style="color: #99C21B; font: bold; margin-left: 5px;">Iniciar sesión</button>\n                                                    </div>\n                    \n                                                    \n                                                    <div class="form-group">\n                                                        <div class="col-md-12 col-sm-12 col-xs-12 text-center" style="padding-top: 10px;">\n                                                            <label style="color: white;">¿Olvidaste tu contraseña? Haz <a href="#" style="color: white; text-decoration: underline;">click aqui</a></label>\n                                                        </div>                                    \n                                                    </div>\n                                                </fieldset>\n                                            </form>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    \n                        <div class="col-md-12 col-sm-12 col-xs-12 text-center" style="padding-top: 10px;">\n                            <label style="color: white; font: bold;">'+n.derechos+"</label>\n                        </div>"}},r={_login:function(){$("body").attr("class","")}},t={_login:function(){$("body").append(i._login()),$(".contenedor").fadeOut("slow"),$("body").attr("class","body-personalizado")}},a={_setCookie:function(e,o,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var r="expires="+i.toUTCString();document.cookie=e+"="+o+";"+r+";path=/"},_getCookie:function(e){for(var o=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(o))return r.substring(o.length,r.length)}return""},_checkCookie:function(e){return""!=this._getCookie(e)?this._getCookie(e):""}},s={_login:function(e){function i(e){o.add(e.target.parentNode,"input--filled")}function r(e){""===e.target.value.trim()&&o.remove(e.target.parentNode,"input--filled")}$("#"+n.usuario.id).val(a._checkCookie("usuario")),$("#"+n.password.id).val(a._checkCookie("password")),""!=a._checkCookie("usuario")&&a._checkCookie("password")?$("#"+n.recordar.id).prop("checked",!0):$("#"+n.recordar.id).prop("checked",!1),String.prototype.trim||!function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}(),[].slice.call(document.querySelectorAll("input.input__field")).forEach(function(e){""!==e.value.trim()&&o.add(e.parentNode,"input--filled"),e.addEventListener("focus",i),e.addEventListener("blur",r)})}},l={_login:function(o,i){var r={success:function(o,i){if(console.log(o),o.response.sucessfull){var r={NombreUsuario:"Ivan",datosUsuario:[]};$("#"+n.recordar.id).is(":checked")?($("#"+n.recordar.id).prop("checked",!0),a._setCookie("usuario","parametro",365),a._setCookie("password","parametro",365)):(a._setCookie("usuario","",365),a._setCookie("password","",365)),r.datosUsuario=o.data,amplify.store(e.variableDeSesion,r),$("body").estructuraGeneral({tituloFormulario:"Bienvenido",datosUsuario:o.data})}else $("#"+n.etiquetaError.id).html(o.response.message)},error:function(e){0==e.readyState&&0==e.status?$("#"+n.etiquetaError.id).html("No se puede establecer conexión con el servidor"):$("#"+n.etiquetaError.id).html("Ocurrió un error al conectarse al servidor")},beforeSend:function(){$("#"+n.etiquetaError.id).html(""),$("#"+n.botonLogin.id).html('<img src="'+n.imagenUrl+'btnImagenLogin.gif">')},complete:function(){$("#"+n.botonLogin.id).html("Iniciar sesión")}};r=$.extend(r,o),r.data=i,$.ajax(r)}},d={_login:function(){$("#"+n.formularioLogin.id).validate({errorElement:"span",wrapper:"label",rules:{empresa:{valueNotEquals:-1},usuario:{required:!0,maxlength:30},password:{required:!0,maxlength:18}},messages:{empresa:{valueNotEquals:"Seleccione una opciòn"},usuario:{required:"Ingresa usuario",maxlength:"Max. 30 caracteres"},password:{required:"Ingresa password",maxlength:"Max. 18 caracteres"}},submitHandler:function(o){l._login(e.urlLogin,{action:"login",user:$("#"+n.usuario.id).val(),password:$("#"+n.password.id).val()})},errorPlacement:function(e,o){"usuario"==$(o[0]).attr("id")?e.appendTo(".errorUsuario"):"password"==$(o[0]).attr("id")&&e.appendTo(".errorPassword")}}),jQuery.validator.addMethod("valueNotEquals",function(e,o,n){return n!=e})}},u=function(){r._login(),t._login(),d._login(),s._login()};return{init:u}});